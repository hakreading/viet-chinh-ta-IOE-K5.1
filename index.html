<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nghe v√† Vi·∫øt Ch√≠nh T·∫£: My First Sentences</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --primary-color: #ec407a;
            --primary-dark: #c2185b;
            --success-color: #4caf50;
            --error-color: #f44336;
            --light-bg: #fce4ec;
            --text-color: #333;
            --white-color: #ffffff;
            --yellow-color: #ffc107;
            --topic-color-1: #ef5350;
            --topic-color-2: #42a5f5;
            --topic-color-3: #66bb6a;
            --topic-color-4: #ffa726;
            --topic-color-5: #ab47bc;
            --topic-color-6: #78909c;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(120deg, #f8bbd0 0%, #ce93d8 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: var(--text-color);
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
        }

        #root {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            text-align: center;
            padding: 25px;
            max-width: 900px;
            width: 95%;
            background: var(--white-color);
            border-radius: 24px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.1), 0 4px 15px rgba(0, 0, 0, 0.05);
            box-sizing: border-box;
        }

        .game-title {
            font-size: clamp(1.8em, 5vw, 2.5em);
            color: var(--primary-color);
            margin: 0 0 5px;
            font-weight: 700;
        }

        .game-subtitle {
            font-size: clamp(1.2em, 4vw, 1.5em);
            margin-bottom: 20px;
            color: #555;
            font-weight: 600;
        }

        .meaning {
            font-size: clamp(1.1em, 4.5vw, 1.6em);
            color: var(--primary-dark);
            margin: 15px 0;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .input-container {
            position: relative;
            margin: 30px 0;
        }

        #answerInput,
        .text-input {
            width: 100%;
            padding: 15px 20px;
            font-size: clamp(1.1em, 4vw, 1.6em);
            font-family: 'Nunito', sans-serif;
            border-radius: 12px;
            border: 3px solid var(--primary-color);
            box-sizing: border-box;
            text-align: center;
            transition: all 0.3s ease;
        }

        #answerInput:focus,
        .text-input:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(236, 64, 122, 0.3);
        }

        #answerInput.correct {
            border-color: var(--success-color);
            background-color: #e8f5e9;
        }

        #answerInput.incorrect {
            border-color: var(--error-color);
            animation: shake 0.5s;
        }

        #hint {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: clamp(1.1em, 4vw, 1.6em);
            font-weight: 600;
            pointer-events: none;
            z-index: 10;
            width: max-content;
            max-width: 90%;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        button {
            background: var(--primary-color);
            color: var(--white-color);
            border: none;
            padding: 12px 28px;
            border-radius: 12px;
            font-size: clamp(0.9em, 3.5vw, 1.1em);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover,
        button:focus {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            outline: none;
        }

        button:disabled {
            background: #bdbdbd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .score {
            font-size: clamp(1.1em, 4vw, 1.4em);
            margin-top: 20px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .message {
            font-size: clamp(1.1em, 4vw, 1.4em);
            margin: 15px 0;
            font-weight: 700;
            min-height: 25px;
            color: var(--error-color);
        }

        .start-screen,
        .topic-selection-screen,
        .topic-congrats-screen,
        .review-errors-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
        }

        .main-btn,
        .topic-btn,
        .congrats-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 16px;
            width: 90%;
            max-width: 450px;
        }
        
        .topic-btn-container {
             display: flex;
             flex-direction: column;
             width: 100%;
             align-items: center;
             gap: 15px;
        }

        .main-btn { background-color: var(--success-color); }
        .main-btn:hover { background: #388e3c; }
        
        .topic-btn-color-1 { background-color: var(--topic-color-1); }
        .topic-btn-color-1:hover { background-color: #d32f2f; }
        .topic-btn-color-2 { background-color: var(--topic-color-2); }
        .topic-btn-color-2:hover { background-color: #1976d2; }
        .topic-btn-color-3 { background-color: var(--topic-color-3); }
        .topic-btn-color-3:hover { background-color: #388e3c; }
        .topic-btn-color-4 { background-color: var(--topic-color-4); }
        .topic-btn-color-4:hover { background-color: #f57c00; }
        .topic-btn-color-5 { background-color: var(--topic-color-5); }
        .topic-btn-color-5:hover { background-color: #8e24aa; }
        .topic-btn-color-6 { background-color: var(--topic-color-6); }
        .topic-btn-color-6:hover { background-color: #546e7a; }

        #playerNameInput {
            font-family: 'Nunito', sans-serif;
            font-size: 1.2em;
            padding: 10px 15px;
            border-radius: 12px;
            border: 2px solid var(--primary-color);
            text-align: center;
            width: 80%;
            max-width: 300px;
        }

        .error-review-list {
            list-style-type: none;
            padding: 0;
            width: 100%;
            max-height: 40vh;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .error-review-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        .error-review-item:last-child {
            border-bottom: none;
        }
        .error-label {
            font-weight: 700;
            font-size: 0.9em;
        }
        .correct-answer {
            color: var(--success-color);
            word-break: break-all;
        }
        .user-answer {
            color: var(--error-color);
            word-break: break-all;
        }
        .error-char {
            color: #d32f2f;
            font-weight: bold;
            text-decoration: underline;
            background-color: #ffebee;
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        @media (max-width: 600px) {
            .container { padding: 15px; }
            button { padding: 10px 20px; }
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const allSentences = [
            { en: "What time do they have dinner?", vi: "M·∫•y gi·ªù h·ªç ƒÉn t·ªëi?", emoji: "‚è∞" },
            { en: "Do their parents live in Hue City?", vi: "B·ªë m·∫π h·ªç c√≥ s·ªëng ·ªü th√†nh ph·ªë Hu·∫ø kh√¥ng?", emoji: "‚ùì" },
            { en: "The children can learn a lot of things at school.", vi: "Tr·∫ª em c√≥ th·ªÉ h·ªçc ƒë∆∞·ª£c nhi·ªÅu ƒëi·ªÅu ·ªü tr∆∞·ªùng.", emoji: "üè´" },
            { en: "A blind person can not see anything.", vi: "Ng∆∞·ªùi m√π kh√¥ng th·ªÉ nh√¨n th·∫•y g√¨.", emoji: "üßë‚Äçü¶Ø" },
            { en: "The food is great.", vi: "Th·ª©c ƒÉn r·∫•t tuy·ªát.", emoji: "üç≤" },
            { en: "I will stay at home to help my mom clean my house.", vi: "T√¥i s·∫Ω ·ªü nh√† gi√∫p m·∫π d·ªçn d·∫πp nh√† c·ª≠a.", emoji: "üè†" },
            { en: "My brother has a pair of brown shoes.", vi: "Anh trai t√¥i c√≥ m·ªôt ƒë√¥i gi√†y m√†u n√¢u.", emoji: "üëû" },
            { en: "What time does your father go to work?", vi: "B·ªë b·∫°n ƒëi l√†m l√∫c m·∫•y gi·ªù?", emoji: "üë®‚Äçüíº" },
            { en: "Where is Thu's school? It's in the city.", vi: "Tr∆∞·ªùng c·ªßa Thu ·ªü ƒë√¢u? N√≥ ·ªü trong th√†nh ph·ªë.", emoji: "üè´" },
            { en: "That is a chair.", vi: "ƒê√≥ l√† m·ªôt c√°i gh·∫ø.", emoji: "ü™ë" },
            { en: "My elder sister is cooking in the kitchen.", vi: "Ch·ªã g√°i t√¥i ƒëang n·∫•u ƒÉn trong b·∫øp.", emoji: "üç≥" },
            { en: "Do you live near the city's supermarket?", vi: "B·∫°n c√≥ s·ªëng g·∫ßn si√™u th·ªã c·ªßa th√†nh ph·ªë kh√¥ng?", emoji: "üõí" },
            { en: "Three and thirty seven is forty.", vi: "Ba v√† ba m∆∞∆°i b·∫£y l√† b·ªën m∆∞∆°i.", emoji: "‚ûï" },
            { en: "What are you listening to on the radio?", vi: "B·∫°n ƒëang nghe g√¨ tr√™n ƒë√†i?", emoji: "üìª" },
            { en: "You can borrow books from the library.", vi: "B·∫°n c√≥ th·ªÉ m∆∞·ª£n s√°ch t·ª´ th∆∞ vi·ªán.", emoji: "üìö" },
            { en: "Does your mother go to work by bus?", vi: "M·∫π b·∫°n ƒëi l√†m b·∫±ng xe bu√Ωt ph·∫£i kh√¥ng?", emoji: "üöå" },
            { en: "My family will explore the caves in Ha Long Bay.", vi: "Gia ƒë√¨nh t√¥i s·∫Ω kh√°m ph√° c√°c hang ƒë·ªông ·ªü V·ªãnh H·∫° Long.", emoji: "üèûÔ∏è" },
            { en: "My brother often plays football in his free time.", vi: "Anh trai t√¥i th∆∞·ªùng ch∆°i b√≥ng ƒë√° v√†o th·ªùi gian r·∫£nh.", emoji: "‚öΩ" },
            { en: "Don't play football on the street, boys.", vi: "C√°c c·∫≠u b√©, ƒë·ª´ng ch∆°i b√≥ng ƒë√° tr√™n ƒë∆∞·ªùng.", emoji: "üö´" },
            { en: "We are making coffee but we don't have any milk.", vi: "Ch√∫ng t√¥i ƒëang pha c√† ph√™ nh∆∞ng ch√∫ng t√¥i kh√¥ng c√≥ s·ªØa.", emoji: "‚òï" },
            { en: "It's three kilometers from my house to my school.", vi: "T·ª´ nh√† t√¥i ƒë·∫øn tr∆∞·ªùng l√† ba c√¢y s·ªë.", emoji: "üè´" },
            { en: "You should try to guess the meaning of a word while you read.", vi: "B·∫°n n√™n c·ªë g·∫Øng ƒëo√°n nghƒ©a c·ªßa m·ªôt t·ª´ khi b·∫°n ƒë·ªçc.", emoji: "ü§î" },
            { en: "How many cakes does she want?", vi: "C√¥ ·∫•y mu·ªën bao nhi√™u c√°i b√°nh?", emoji: "üéÇ" },
            { en: "Where's your address? It's at 201, Tran Hung Dao Street.", vi: "ƒê·ªãa ch·ªâ c·ªßa b·∫°n ·ªü ƒë√¢u? ·ªû s·ªë 201, ƒë∆∞·ªùng Tr·∫ßn H∆∞ng ƒê·∫°o.", emoji: "üè†" },
            { en: "We have English on Monday and Thursday. We have it twice a week.", vi: "Ch√∫ng t√¥i c√≥ ti·∫øng Anh v√†o th·ª© Hai v√† th·ª© NƒÉm. Ch√∫ng t√¥i h·ªçc n√≥ hai l·∫ßn m·ªôt tu·∫ßn.", emoji: "üá¨üáß" },
            { en: "My brother and I look like my mother.", vi: "Anh trai t√¥i v√† t√¥i tr√¥ng gi·ªëng m·∫π t√¥i.", emoji: "üë©‚Äçüë¶‚Äçüë¶" },
            { en: "Every morning she gets up early.", vi: "M·ªói bu·ªïi s√°ng c√¥ ·∫•y ƒë·ªÅu d·∫≠y s·ªõm.", emoji: "üåÖ" },
            { en: "Clara sometimes goes out with a friend for dinner.", vi: "Clara th·ªânh tho·∫£ng ƒëi ƒÉn t·ªëi v·ªõi b·∫°n.", emoji: "üçΩÔ∏è" },
            { en: "What's the date today? It's 21st November.", vi: "H√¥m nay l√† ng√†y m·∫•y? Ng√†y 21 th√°ng 11.", emoji: "üóìÔ∏è" },
            { en: "Where is Paula? She is in her room.", vi: "Paula ƒë√¢u r·ªìi? C√¥ ·∫•y ·ªü trong ph√≤ng c·ªßa m√¨nh.", emoji: "üõå" },
            { en: "They prepare food and drink for their holiday.", vi: "H·ªç chu·∫©n b·ªã th·ª©c ƒÉn v√† ƒë·ªì u·ªëng cho k·ª≥ ngh·ªâ c·ªßa h·ªç.", emoji: "üçπ" },
            { en: "When was the last birthday party you went to?", vi: "B·ªØa ti·ªác sinh nh·∫≠t cu·ªëi c√πng b·∫°n tham d·ª± l√† khi n√†o?", emoji: "üéâ" },
            { en: "How much sugar is there in the glass?", vi: "C√≥ bao nhi√™u ƒë∆∞·ªùng trong ly?", emoji: "ü•õ" },
            { en: "Nam gives Mai an orange sock.", vi: "Nam ƒë∆∞a cho Mai m·ªôt chi·∫øc t·∫•t m√†u cam.", emoji: "üß¶" },
            { en: "Is this green? Yes, it is. It is green.", vi: "ƒê√¢y c√≥ ph·∫£i m√†u xanh l√° c√¢y kh√¥ng? V√¢ng, ƒë√∫ng v·∫≠y. N√≥ l√† m√†u xanh l√° c√¢y.", emoji: "üü¢" },
            { en: "Is your father going to have tea and read a newspaper?", vi: "B·ªë b·∫°n s·∫Ω u·ªëng tr√† v√† ƒë·ªçc b√°o ph·∫£i kh√¥ng?", emoji: "üì∞" },
            { en: "What is your favorite color? I like red.", vi: "M√†u s·∫Øc y√™u th√≠ch c·ªßa b·∫°n l√† g√¨? T√¥i th√≠ch m√†u ƒë·ªè.", emoji: "üî¥" },
            { en: "What colour do you like? Pink.", vi: "B·∫°n th√≠ch m√†u g√¨? M√†u h·ªìng.", emoji: "üå∏" },
            { en: "He'll be an astronaut.", vi: "Anh ·∫•y s·∫Ω l√† m·ªôt phi h√†nh gia.", emoji: "üë®‚ÄçüöÄ" },
            { en: "He stops smoking to save money.", vi: "Anh ·∫•y b·ªè h√∫t thu·ªëc ƒë·ªÉ ti·∫øt ki·ªám ti·ªÅn.", emoji: "üö≠" },
            { en: "I am happy because today is my birthday.", vi: "T√¥i vui v√¨ h√¥m nay l√† sinh nh·∫≠t c·ªßa t√¥i.", emoji: "üéÇ" },
            { en: "I really enjoy it.", vi: "T√¥i th·ª±c s·ª± th√≠ch n√≥.", emoji: "üòÑ" },
            { en: "Linh lives and works in a small village.", vi: "Linh s·ªëng v√† l√†m vi·ªác ·ªü m·ªôt ng√¥i l√†ng nh·ªè.", emoji: "üèûÔ∏è" },
            { en: "How does she travel to Hanoi? She travels to Hanoi by plane.", vi: "C√¥ ·∫•y ƒëi ƒë·∫øn H√† N·ªôi b·∫±ng c√°ch n√†o? C√¥ ·∫•y ƒëi ƒë·∫øn H√† N·ªôi b·∫±ng m√°y bay.", emoji: "‚úàÔ∏è" },
            { en: "How do you go to school? On foot.", vi: "B·∫°n ƒëi h·ªçc b·∫±ng g√¨? ƒêi b·ªô.", emoji: "üö∂" },
            { en: "Where are your parents? They are watching TV in the living room.", vi: "B·ªë m·∫π b·∫°n ƒë√¢u? H·ªç ƒëang xem TV trong ph√≤ng kh√°ch.", emoji: "üì∫" },
            { en: "I didn't watch that cartoon on TV last night.", vi: "T·ªëi qua t√¥i ƒë√£ kh√¥ng xem b·ªô phim ho·∫°t h√¨nh ƒë√≥ tr√™n TV.", emoji: " ‡§ï‡§æ‡§∞‡•ç‡§ü‡•Ç‡§®" },
            { en: "I'm going to draw my house.", vi: "T√¥i s·∫Ω v·∫Ω ng√¥i nh√† c·ªßa t√¥i.", emoji: "üé®" },
            { en: "Do you have any interesting activities at your club?", vi: "B·∫°n c√≥ ho·∫°t ƒë·ªông th√∫ v·ªã n√†o ·ªü c√¢u l·∫°c b·ªô c·ªßa b·∫°n kh√¥ng?", emoji: "üéâ" },
            { en: "September 2nd is our National Day.", vi: "Ng√†y 2 th√°ng 9 l√† ng√†y Qu·ªëc kh√°nh c·ªßa ch√∫ng ta.", emoji: "üáªüá≥" },
            { en: "What time did you get up yesterday?", vi: "H√¥m qua b·∫°n th·ª©c d·∫≠y l√∫c m·∫•y gi·ªù?", emoji: "‚è∞" },
            { en: "This is Toby. His toy is under the tree.", vi: "ƒê√¢y l√† Toby. ƒê·ªì ch∆°i c·ªßa c·∫≠u ·∫•y ·ªü d∆∞·ªõi g·ªëc c√¢y.", emoji: "üß∏" },
            { en: "The puppets are beautiful.", vi: "Nh·ªØng con r·ªëi th·∫≠t ƒë·∫πp.", emoji: "üéé" },
            { en: "What do you prefer, fairy tales or short stories?", vi: "B·∫°n th√≠ch truy·ªán c·ªï t√≠ch hay truy·ªán ng·∫Øn h∆°n?", emoji: "üìñ" },
            { en: "He sometimes plays video games at the weekend.", vi: "Anh ·∫•y th·ªânh tho·∫£ng ch∆°i tr√≤ ch∆°i ƒëi·ªán t·ª≠ v√†o cu·ªëi tu·∫ßn.", emoji: "üéÆ" },
            { en: "Cheese is made from milk.", vi: "Ph√¥ mai ƒë∆∞·ª£c l√†m t·ª´ s·ªØa.", emoji: "üßÄ" },
            { en: "Did you go on a picnic with your family last weekend?", vi: "Cu·ªëi tu·∫ßn tr∆∞·ªõc b·∫°n c√≥ ƒëi d√£ ngo·∫°i v·ªõi gia ƒë√¨nh kh√¥ng?", emoji: "üß∫" },
            { en: "Does Mr. Smith want a new raincoat?", vi: "√îng Smith c√≥ mu·ªën m·ªôt chi·∫øc √°o m∆∞a m·ªõi kh√¥ng?", emoji: "üß•" },
            { en: "After school, Jane plays badminton with her brother.", vi: "Sau gi·ªù h·ªçc, Jane ch∆°i c·∫ßu l√¥ng v·ªõi anh trai.", emoji: "üè∏" },
            { en: "Why don't we go camping? That's a good idea.", vi: "T·∫°i sao ch√∫ng ta kh√¥ng ƒëi c·∫Øm tr·∫°i? ƒê√≥ l√† m·ªôt √Ω ki·∫øn hay.", emoji: "üèïÔ∏è" },
            { en: "Students should review their work before test.", vi: "H·ªçc sinh n√™n xem l·∫°i b√†i c·ªßa m√¨nh tr∆∞·ªõc khi ki·ªÉm tra.", emoji: "üìù" },
            { en: "Can you guess his job?", vi: "B·∫°n c√≥ th·ªÉ ƒëo√°n ngh·ªÅ nghi·ªáp c·ªßa anh ·∫•y kh√¥ng?", emoji: "‚ùì" },
            { en: "I have some homework today.", vi: "H√¥m nay t√¥i c√≥ m·ªôt √≠t b√†i t·∫≠p v·ªÅ nh√†.", emoji: "‚úçÔ∏è" },
            { en: "How many notebooks do you want to buy?", vi: "B·∫°n mu·ªën mua bao nhi√™u quy·ªÉn v·ªü?", emoji: "üìì" },
            { en: "My brother watches TV more often than I do.", vi: "Anh trai t√¥i xem TV th∆∞·ªùng xuy√™n h∆°n t√¥i.", emoji: "üì∫" },
            { en: "What is your address? 61 Nguyen Trai Street, Thanh Xuan, Hanoi.", vi: "ƒê·ªãa ch·ªâ c·ªßa b·∫°n l√† g√¨? 61 ƒë∆∞·ªùng Nguy·ªÖn Tr√£i, Thanh Xu√¢n, H√† N·ªôi.", emoji: "üè†" },
            { en: "My classmates are waiting for me at the cinema.", vi: "C√°c b·∫°n c√πng l·ªõp ƒëang ƒë·ª£i t√¥i ·ªü r·∫°p chi·∫øu phim.", emoji: "üé¨" },
            { en: "What grade is Quan in? He's in grade 5.", vi: "Qu√¢n h·ªçc l·ªõp m·∫•y? C·∫≠u ·∫•y h·ªçc l·ªõp 5.", emoji: "üßë‚Äçüéì" },
            { en: "Do you often visit museums at weekends?", vi: "B·∫°n c√≥ th∆∞·ªùng ƒë·∫øn thƒÉm b·∫£o t√†ng v√†o cu·ªëi tu·∫ßn kh√¥ng?", emoji: "üèõÔ∏è" },
            { en: "I live in a village.", vi: "T√¥i s·ªëng ·ªü m·ªôt ng√¥i l√†ng.", emoji: "üèûÔ∏è" },
            { en: "I have Science twice a week, on Tuesday and Thursday.", vi: "T√¥i c√≥ m√¥n Khoa h·ªçc hai l·∫ßn m·ªôt tu·∫ßn, v√†o th·ª© Ba v√† th·ª© NƒÉm.", emoji: "üî¨" },
            { en: "He never goes to the cafeteria at lunchtime.", vi: "Anh ·∫•y kh√¥ng bao gi·ªù ƒë·∫øn nh√† ƒÉn v√†o gi·ªù ƒÉn tr∆∞a.", emoji: "üçΩÔ∏è" },
            { en: "What would you like to drink? Orange juice, please.", vi: "B·∫°n mu·ªën u·ªëng g√¨? N∆∞·ªõc cam √©p, l√†m ∆°n.", emoji: "üçä" },
            { en: "What colours are the flowers? Pink and white.", vi: "Nh·ªØng b√¥ng hoa m√†u g√¨? M√†u h·ªìng v√† m√†u tr·∫Øng.", emoji: "üå∏" },
            { en: "It's often warm in summer and cool in autumn.", vi: "Tr·ªùi th∆∞·ªùng ·∫•m v√†o m√πa h√® v√† m√°t m·∫ª v√†o m√πa thu.", emoji: "‚òÄÔ∏è" },
            { en: "Classes start at seven and end at half past seven.", vi: "C√°c l·ªõp h·ªçc b·∫Øt ƒë·∫ßu l√∫c b·∫£y gi·ªù v√† k·∫øt th√∫c l√∫c b·∫£y gi·ªù r∆∞·ª°i.", emoji: "‚è∞" },
            { en: "Who is waiting for him?", vi: "Ai ƒëang ƒë·ª£i anh ·∫•y?", emoji: "‚ùì" },
            { en: "We are waiting for our friends.", vi: "Ch√∫ng t√¥i ƒëang ƒë·ª£i b·∫°n b√® c·ªßa ch√∫ng t√¥i.", emoji: "üßë‚Äçü§ù‚Äçüßë" },
            { en: "What will we do in the morning? We'll do exercise then go to school.", vi: "Ch√∫ng ta s·∫Ω l√†m g√¨ v√†o bu·ªïi s√°ng? Ch√∫ng ta s·∫Ω t·∫≠p th·ªÉ d·ª•c r·ªìi ƒë·∫øn tr∆∞·ªùng.", emoji: "ü§∏" },
            { en: "He always has chicken and rice for lunch.", vi: "Anh ·∫•y lu√¥n ƒÉn c∆°m g√† v√†o b·ªØa tr∆∞a.", emoji: "üçó" },
            { en: "What was the weather like yesterday?", vi: "Th·ªùi ti·∫øt h√¥m qua th·∫ø n√†o?", emoji: "üå¶Ô∏è" },
            { en: "I saw some monkeys at the zoo.", vi: "T√¥i ƒë√£ th·∫•y m·ªôt v√†i con kh·ªâ ·ªü s·ªü th√∫.", emoji: "üêí" },
            { en: "They climbed trees quickly and liked bananas.", vi: "Ch√∫ng tr√®o c√¢y nhanh v√† th√≠ch chu·ªëi.", emoji: "üçå" },
            { en: "When were you born? In July.", vi: "B·∫°n sinh v√†o khi n√†o? V√†o th√°ng B·∫£y.", emoji: "üéÇ" },
            { en: "The seas and rivers are too dirty to swim in.", vi: "Bi·ªÉn v√† s√¥ng qu√° b·∫©n ƒë·ªÉ b∆°i.", emoji: "üåä" },
            { en: "How far is it from your house to school? It's about 2 kilometers.", vi: "T·ª´ nh√† b·∫°n ƒë·∫øn tr∆∞·ªùng bao xa? Kho·∫£ng 2 c√¢y s·ªë.", emoji: "üìè" },
            { en: "Did you go to Mai's birthday party?", vi: "B·∫°n c√≥ ƒë·∫øn d·ª± ti·ªác sinh nh·∫≠t c·ªßa Mai kh√¥ng?", emoji: "üéâ" },
            { en: "\"Fall\" means \"autumn\" in British English.", vi: "\"Fall\" c√≥ nghƒ©a l√† \"m√πa thu\" trong ti·∫øng Anh Anh.", emoji: "üçÇ" },
            { en: "I ride my bicycle to school every day.", vi: "T√¥i ƒë·∫°p xe ƒë·∫øn tr∆∞·ªùng m·ªói ng√†y.", emoji: "üö≤" },
            { en: "Would you like a cup of tea?", vi: "B·∫°n c√≥ mu·ªën m·ªôt t√°ch tr√† kh√¥ng?", emoji: "‚òï" },
            { en: "She lives in a small house and she doesn't like it.", vi: "C√¥ ·∫•y s·ªëng trong m·ªôt ng√¥i nh√† nh·ªè v√† c√¥ ·∫•y kh√¥ng th√≠ch n√≥.", emoji: "üè†" },
            { en: "Is he ten years old? No, he is not.", vi: "C·∫≠u ·∫•y m∆∞·ªùi tu·ªïi ph·∫£i kh√¥ng? Kh√¥ng, kh√¥ng ph·∫£i.", emoji: "üë¶" },
            { en: "I want to eat two eggs now, I'm too hungry.", vi: "T√¥i mu·ªën ƒÉn hai qu·∫£ tr·ª©ng b√¢y gi·ªù, t√¥i ƒë√≥i qu√°.", emoji: "üç≥" },
            { en: "She reads newspapers 3 times a week.", vi: "C√¥ ·∫•y ƒë·ªçc b√°o 3 l·∫ßn m·ªôt tu·∫ßn.", emoji: "üì∞" },
            { en: "Phong will stay at home this weekend because he has to study.", vi: "Phong s·∫Ω ·ªü nh√† cu·ªëi tu·∫ßn n√†y v√¨ c·∫≠u ·∫•y ph·∫£i h·ªçc.", emoji: "üìö" },
            { en: "Are those the toys you want to buy?", vi: "ƒê√≥ c√≥ ph·∫£i l√† nh·ªØng m√≥n ƒë·ªì ch∆°i b·∫°n mu·ªën mua kh√¥ng?", emoji: "üß∏" },
            { en: "My parents always come home late in the afternoon.", vi: "B·ªë m·∫π t√¥i lu√¥n v·ªÅ nh√† mu·ªôn v√†o bu·ªïi chi·ªÅu.", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
            { en: "Don't talk about people behind their backs.", vi: "ƒê·ª´ng n√≥i x·∫•u sau l∆∞ng ng∆∞·ªùi kh√°c.", emoji: "ü§´" },
            { en: "How much money do you have?", vi: "B·∫°n c√≥ bao nhi√™u ti·ªÅn?", emoji: "üí∞" },
            { en: "I'd like to pay for this food. Where is the shop assistant?", vi: "T√¥i mu·ªën tr·∫£ ti·ªÅn cho m√≥n ƒÉn n√†y. Ng∆∞·ªùi b√°n h√†ng ·ªü ƒë√¢u?", emoji: "üõí" },
            { en: "Does Jack often do aerobics in summer?", vi: "Jack c√≥ th∆∞·ªùng t·∫≠p th·ªÉ d·ª•c nh·ªãp ƒëi·ªáu v√†o m√πa h√® kh√¥ng?", emoji: "ü§∏" },
            { en: "Anna was excited and happy about the good news.", vi: "Anna ƒë√£ r·∫•t ph·∫•n kh√≠ch v√† vui m·ª´ng v·ªÅ tin t·ªët.", emoji: "üòÑ" },
            { en: "You should ride slowly.", vi: "B·∫°n n√™n ƒëi xe ch·∫≠m th√¥i.", emoji: "üö≤" },
            { en: "Her face was pretty, too.", vi: "Khu√¥n m·∫∑t c·ªßa c√¥ ·∫•y c≈©ng xinh ƒë·∫πp.", emoji: "üòä" },
            { en: "Another word for \"table tennis\" is \"ping-pong\".", vi: "M·ªôt t·ª´ kh√°c cho \"b√≥ng b√†n\" l√† \"ping-pong\".", emoji: "üèì" },
            { en: "I don't like to talk to him.", vi: "T√¥i kh√¥ng th√≠ch n√≥i chuy·ªán v·ªõi anh ·∫•y.", emoji: "üó£Ô∏è" },
            { en: "Mary is the only child of her parents.", vi: "Mary l√† con m·ªôt c·ªßa b·ªë m·∫π c√¥ ·∫•y.", emoji: "üë®‚Äçüë©‚Äçüëß" },
            { en: "Her classmate likes Music best.", vi: "B·∫°n c√πng l·ªõp c·ªßa c√¥ ·∫•y th√≠ch √Çm nh·∫°c nh·∫•t.", emoji: "üéµ" },
            { en: "He travels to Japan by airplane.", vi: "Anh ·∫•y ƒëi du l·ªãch Nh·∫≠t B·∫£n b·∫±ng m√°y bay.", emoji: "‚úàÔ∏è" },
            { en: "Which province is in Central Vietnam?", vi: "T·ªânh n√†o ·ªü mi·ªÅn Trung Vi·ªát Nam?", emoji: "üáªüá≥" },
            { en: "What's the matter with you?", vi: "B·∫°n b·ªã sao v·∫≠y?", emoji: "‚ùì" },
            { en: "Could you close the window for me?", vi: "B·∫°n c√≥ th·ªÉ ƒë√≥ng c·ª≠a s·ªï gi√∫p t√¥i ƒë∆∞·ª£c kh√¥ng?", emoji: "ü™ü" },
            { en: "Is she from Malaysia?", vi: "C√¥ ·∫•y ƒë·∫øn t·ª´ Malaysia ph·∫£i kh√¥ng?", emoji: "üá≤üáæ" },
            { en: "My sister and I usually watch cartoons on TV in the evening.", vi: "Ch·ªã t√¥i v√† t√¥i th∆∞·ªùng xem phim ho·∫°t h√¨nh tr√™n TV v√†o bu·ªïi t·ªëi.", emoji: "üì∫" },
            { en: "Are you waiting for the train? Yes, I am.", vi: "B·∫°n ƒëang ƒë·ª£i t√†u ph·∫£i kh√¥ng? V√¢ng, ƒë√∫ng v·∫≠y.", emoji: "üöÇ" },
            { en: "I love fruits. I always eat fruits after dinner.", vi: "T√¥i y√™u tr√°i c√¢y. T√¥i lu√¥n ƒÉn tr√°i c√¢y sau b·ªØa t·ªëi.", emoji: "üçé" },
            { en: "Where can I learn about animals? Maybe at the zoo.", vi: "T√¥i c√≥ th·ªÉ t√¨m hi·ªÉu v·ªÅ ƒë·ªông v·∫≠t ·ªü ƒë√¢u? C√≥ l·∫Ω ·ªü s·ªü th√∫.", emoji: "ü¶ì" },
            { en: "I'd like some tomatoes for my breakfast.", vi: "T√¥i mu·ªën m·ªôt √≠t c√† chua cho b·ªØa s√°ng.", emoji: "üçÖ" },
            { en: "How are you going to get to Hung King Temple next weekend? By bus.", vi: "B·∫°n s·∫Ω ƒë·∫øn ƒê·ªÅn H√πng v√†o cu·ªëi tu·∫ßn t·ªõi b·∫±ng c√°ch n√†o? B·∫±ng xe bu√Ωt.", emoji: "üöå" },
            { en: "Why do you like football?", vi: "T·∫°i sao b·∫°n th√≠ch b√≥ng ƒë√°?", emoji: "‚öΩ" },
            { en: "This is a magic lamp.", vi: "ƒê√¢y l√† m·ªôt c√¢y ƒë√®n th·∫ßn.", emoji: "Îû®ÌîÑ" },
            { en: "It is raining heavily.", vi: "Tr·ªùi ƒëang m∆∞a to.", emoji: "üåßÔ∏è" },
            { en: "Miss Kate is pretty.", vi: "C√¥ Kate xinh ƒë·∫πp.", emoji: "üë©" },
            { en: "She eats potatoes, but her brother doesn't.", vi: "C√¥ ·∫•y ƒÉn khoai t√¢y, nh∆∞ng anh trai c√¥ ·∫•y th√¨ kh√¥ng.", emoji: "ü•î" },
            { en: "You can buy some books or some pens at the bookshop.", vi: "B·∫°n c√≥ th·ªÉ mua m·ªôt v√†i quy·ªÉn s√°ch ho·∫∑c m·ªôt v√†i c√¢y b√∫t ·ªü hi·ªáu s√°ch.", emoji: "üìö" },
            { en: "Are you sure of your answer?", vi: "B·∫°n c√≥ ch·∫Øc ch·∫Øn v·ªÅ c√¢u tr·∫£ l·ªùi c·ªßa m√¨nh kh√¥ng?", emoji: "‚ùì" },
            { en: "It's the most exciting event in London every year.", vi: "ƒê√≥ l√† s·ª± ki·ªán th√∫ v·ªã nh·∫•t ·ªü London h√†ng nƒÉm.", emoji: "üéâ" },
            { en: "Where is your best friend from?", vi: "B·∫°n th√¢n c·ªßa b·∫°n ƒë·∫øn t·ª´ ƒë√¢u?", emoji: "üßë‚Äçü§ù‚Äçüßë" },
            { en: "What was the matter with him? He had a toothache.", vi: "Anh ·∫•y b·ªã sao v·∫≠y? Anh ·∫•y b·ªã ƒëau rƒÉng.", emoji: "ü¶∑" },
            { en: "Don't run straight across the road.", vi: "ƒê·ª´ng ch·∫°y th·∫≥ng qua ƒë∆∞·ªùng.", emoji: "üèÉ" },
            { en: "What does your little sister do in her free time? She listens to music.", vi: "Em g√°i b·∫°n l√†m g√¨ v√†o th·ªùi gian r·∫£nh? Em ·∫•y nghe nh·∫°c.", emoji: "üéß" },
            { en: "The girl likes reading books.", vi: "C√¥ g√°i th√≠ch ƒë·ªçc s√°ch.", emoji: "üìñ" },
            { en: "When does school year start and finish?", vi: "NƒÉm h·ªçc b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c khi n√†o?", emoji: "üóìÔ∏è" },
            { en: "These pens are expensive.", vi: "Nh·ªØng c√¢y b√∫t n√†y ƒë·∫Øt ti·ªÅn.", emoji: "‚úíÔ∏è" },
            { en: "Alan wants to be a taxi driver.", vi: "Alan mu·ªën tr·ªü th√†nh m·ªôt t√†i x·∫ø taxi.", emoji: "üöï" },
            { en: "How do you go to school? I walk.", vi: "B·∫°n ƒëi h·ªçc b·∫±ng g√¨? T√¥i ƒëi b·ªô.", emoji: "üö∂" },
            { en: "Do you enjoy playing games with friends?", vi: "B·∫°n c√≥ th√≠ch ch∆°i game v·ªõi b·∫°n b√® kh√¥ng?", emoji: "üéÆ" },
            { en: "There were a lot of interesting activities at the party.", vi: "C√≥ r·∫•t nhi·ªÅu ho·∫°t ƒë·ªông th√∫ v·ªã t·∫°i b·ªØa ti·ªác.", emoji: "üéâ" },
            { en: "He looked at the board and listened to the teacher carefully.", vi: "C·∫≠u ·∫•y nh√¨n l√™n b·∫£ng v√† l·∫Øng nghe gi√°o vi√™n m·ªôt c√°ch c·∫©n th·∫≠n.", emoji: "üßë‚Äçüè´" },
            { en: "We get dressed, then we brush our teeth.", vi: "Ch√∫ng t√¥i m·∫∑c qu·∫ßn √°o, sau ƒë√≥ ch√∫ng t√¥i ƒë√°nh rƒÉng.", emoji: "üëï" },
            { en: "My mother is tired enough to cook tonight.", vi: "M·∫π t√¥i ƒë·ªß m·ªát ƒë·ªÉ n·∫•u ƒÉn t·ªëi nay.", emoji: "üë©‚Äçüç≥" },
            { en: "Everyday, I get up early to do morning exercises.", vi: "H√†ng ng√†y, t√¥i d·∫≠y s·ªõm ƒë·ªÉ t·∫≠p th·ªÉ d·ª•c bu·ªïi s√°ng.", emoji: "ü§∏" },
            { en: "Look at that strange man. He is looking for Lan but she isn't here.", vi: "Nh√¨n ng∆∞·ªùi ƒë√†n √¥ng l·∫° kia. Anh ta ƒëang t√¨m Lan nh∆∞ng c√¥ ·∫•y kh√¥ng c√≥ ·ªü ƒë√¢y.", emoji: "üëÄ" },
            { en: "Someday I will go out and walk in space.", vi: "M·ªôt ng√†y n√†o ƒë√≥ t√¥i s·∫Ω ƒëi ra ngo√†i v√† ƒëi b·ªô trong kh√¥ng gian.", emoji: "üöÄ" },
            { en: "I'm not hungry but I'm thirsty.", vi: "T√¥i kh√¥ng ƒë√≥i nh∆∞ng t√¥i kh√°t.", emoji: "üíß" },
            { en: "My father knows a lot about Vietnamese history.", vi: "B·ªë t√¥i bi·∫øt r·∫•t nhi·ªÅu v·ªÅ l·ªãch s·ª≠ Vi·ªát Nam.", emoji: "üáªüá≥" },
            { en: "Everyone often claps their hands when she sings.", vi: "M·ªçi ng∆∞·ªùi th∆∞·ªùng v·ªó tay khi c√¥ ·∫•y h√°t.", emoji: "üëè" },
            { en: "He doesn't often go jogging.", vi: "Anh ·∫•y kh√¥ng th∆∞·ªùng xuy√™n ƒëi b·ªô th·ªÉ d·ª•c.", emoji: "üèÉ" },
            { en: "My class has 32 students.", vi: "L·ªõp t√¥i c√≥ 32 h·ªçc sinh.", emoji: "üßë‚Äçüéì" },
            { en: "Why does she get up so early?", vi: "T·∫°i sao c√¥ ·∫•y l·∫°i d·∫≠y s·ªõm nh∆∞ v·∫≠y?", emoji: "‚ùì" }
        ];

        function createTopics(sentences, chunkSize) {
            const shuffled = [...sentences].sort(() => Math.random() - 0.5);
            const topics = {};
            let topicIndex = 1;
            for (let i = 0; i < shuffled.length; i += chunkSize) {
                const chunk = shuffled.slice(i, i + chunkSize);
                topics[`Ch·ªß ƒë·ªÅ ${topicIndex}`] = chunk;
                topicIndex++;
            }
            return topics;
        }

        const topics = createTopics(allSentences, 50);
        
        const GameState = {
            START: 'start',
            TOPIC_SELECTION: 'topicSelection',
            GAME: 'game',
            CONGRATS: 'congrats',
            REVIEW_ERRORS: 'review',
        };

        function useSpeechSynthesis() {
            const [isSpeaking, setIsSpeaking] = useState(false);
            const synth = window.speechSynthesis;

            const speak = useCallback((text, options = {}) => {
                if (!synth) return;

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = options.rate || 0.9;
                utterance.onstart = () => setIsSpeaking(true);
                utterance.onend = () => {
                    setIsSpeaking(false);
                    if (options.onEnd) options.onEnd();
                };
                utterance.onerror = () => {
                     setIsSpeaking(false);
                };

                if (synth.speaking) {
                    synth.cancel();
                }

                setTimeout(() => synth.speak(utterance), 100);

            }, [synth]);

            const cancel = useCallback(() => {
                if (synth) {
                    synth.cancel();
                    setIsSpeaking(false);
                }
            }, [synth]);

            useEffect(() => {
                return () => cancel();
            }, [cancel]);

            return { isSpeaking, speak, cancel };
        }

        function Fireworks() {
            const canvasRef = useRef(null);
            const animationFrameId = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let width = canvas.width = window.innerWidth;
                let height = canvas.height = window.innerHeight;
                let fireworks = [];
                let particles = [];
                let hue = 120;

                function random(min, max) { return Math.random() * (max - min) + min; }

                function Firework(sx, sy, tx, ty) {
                    this.x = sx; this.y = sy; this.sx = sx; this.sy = sy;
                    this.tx = tx; this.ty = ty;
                    this.distanceToTarget = Math.sqrt(Math.pow(tx - sx, 2) + Math.pow(ty - sy, 2));
                    this.distanceTraveled = 0;
                    this.coordinates = [];
                    this.coordinateCount = 3;
                    while (this.coordinateCount--) {
                        this.coordinates.push([this.x, this.y]);
                    }
                    this.angle = Math.atan2(ty - sy, tx - sx);
                    this.speed = 2;
                    this.acceleration = 1.05;
                    this.brightness = random(50, 70);
                    this.targetRadius = 1;
                }

                Firework.prototype.update = function (index) {
                    this.coordinates.pop();
                    this.coordinates.unshift([this.x, this.y]);
                    this.speed *= this.acceleration;
                    const vx = Math.cos(this.angle) * this.speed;
                    const vy = Math.sin(this.angle) * this.speed;
                    this.distanceTraveled = Math.sqrt(Math.pow(this.x + vx - this.sx, 2) + Math.pow(this.y + vy - this.sy, 2));
                    if (this.distanceTraveled >= this.distanceToTarget) {
                        fireworks.splice(index, 1);
                        for (let i = 0; i < 30; i++) {
                            particles.push(new Particle(this.tx, this.ty));
                        }
                    } else {
                        this.x += vx;
                        this.y += vy;
                    }
                };

                Firework.prototype.draw = function () {
                    ctx.beginPath();
                    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
                    ctx.lineTo(this.x, this.y);
                    ctx.strokeStyle = `hsl(${hue}, 100%, ${this.brightness}%)`;
                    ctx.stroke();
                };

                function Particle(x, y) {
                    this.x = x; this.y = y;
                    this.coordinates = [];
                    this.coordinateCount = 5;
                    while (this.coordinateCount--) {
                        this.coordinates.push([this.x, this.y]);
                    }
                    this.angle = random(0, Math.PI * 2);
                    this.speed = random(1, 10);
                    this.friction = 0.95;
                    this.gravity = 1;
                    this.hue = random(hue - 20, hue + 20);
                    this.brightness = random(50, 80);
                    this.alpha = 1;
                    this.decay = random(0.015, 0.03);
                }

                Particle.prototype.update = function (index) {
                    this.coordinates.pop();
                    this.coordinates.unshift([this.x, this.y]);
                    this.speed *= this.friction;
                    this.x += Math.cos(this.angle) * this.speed;
                    this.y += Math.sin(this.angle) * this.speed + this.gravity;
                    this.alpha -= this.decay;
                    if (this.alpha <= this.decay) {
                        particles.splice(index, 1);
                    }
                };

                Particle.prototype.draw = function () {
                    ctx.beginPath();
                    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
                    ctx.lineTo(this.x, this.y);
                    ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
                    ctx.stroke();
                };

                function loop() {
                    animationFrameId.current = requestAnimationFrame(loop);
                    hue += 0.5;
                    ctx.globalCompositeOperation = 'destination-out';
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(0, 0, width, height);
                    ctx.globalCompositeOperation = 'lighter';
                    if (Math.random() < 0.05) {
                        fireworks.push(new Firework(width / 2, height, random(0, width), random(0, height / 2)));
                    }
                    fireworks.forEach((f, i) => { f.update(i); f.draw(); });
                    particles.forEach((p, i) => { p.update(i); p.draw(); });
                }

                const handleResize = () => {
                    width = canvas.width = window.innerWidth;
                    height = canvas.height = window.innerHeight;
                };

                window.addEventListener('resize', handleResize);
                loop();

                return () => {
                    cancelAnimationFrame(animationFrameId.current);
                    window.removeEventListener('resize', handleResize);
                };
            }, []);

            return <canvas ref={canvasRef}></canvas>;
        }

        function StartScreen({ onStart }) {
            const [playerName, setPlayerName] = useState('');
            const [error, setError] = useState('');

            const handleStart = () => {
                if (playerName.trim()) {
                    onStart(playerName.trim());
                } else {
                    setError('Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n!');
                    setTimeout(() => setError(''), 3000);
                }
            };

            return (
                <div className="start-screen">
                    <input
                        type="text"
                        id="playerNameInput"
                        className="text-input"
                        placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..."
                        value={playerName}
                        onChange={(e) => setPlayerName(e.target.value)}
                        onKeyDown={(e) => e.key === 'Enter' && handleStart()}
                    />
                    <button id="startBtn" className="main-btn" onClick={handleStart}>B·∫Øt ƒë·∫ßu</button>
                    {error && <div className="message">{error}</div>}
                </div>
            );
        }

        function TopicSelectionScreen({ onSelectTopic }) {
            return (
                <div className="topic-selection-screen">
                    <div className="game-subtitle">Ch·ªçn m·ªôt ch·ªß ƒë·ªÅ ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>
                    <div className="topic-btn-container">
                        {Object.keys(topics).map((topic, index) => (
                            <button
                                key={topic}
                                className={`topic-btn topic-btn-color-${(index % 6) + 1}`}
                                onClick={() => onSelectTopic(topic)}
                            >
                                {`${topic} (${topics[topic].length} c√¢u)`}
                            </button>
                        ))}
                    </div>
                </div>
            );
        }
        
        function ReviewErrorsScreen({ errors, onSelectTopic }) {
            const renderDiff = (correct, user) => {
                const diff = [];
                const maxLength = Math.max(correct.length, user.length);
                for(let i = 0; i < maxLength; i++) {
                    if (correct[i] !== user[i]) {
                         diff.push(<span key={i} className="error-char">{user[i] || ''}</span>);
                    } else {
                         diff.push(<span key={i}>{user[i]}</span>);
                    }
                }
                return diff;
            };

            return (
                <div className="review-errors-screen">
                     <div className="game-subtitle">Xem l·∫°i c√°c c√¢u tr·∫£ l·ªùi sai</div>
                     <ul className="error-review-list">
                        {errors.map((error, index) => (
                            <li key={index} className="error-review-item">
                                <div className="error-label">ƒê√°p √°n ƒë√∫ng:</div>
                                <p className="correct-answer">{error.correctAnswer}</p>
                                <div className="error-label">C√¢u tr·∫£ l·ªùi c·ªßa b·∫°n:</div>
                                <p className="user-answer">{renderDiff(error.correctAnswer, error.userAnswer)}</p>
                            </li>
                        ))}
                     </ul>
                     <button className="congrats-btn" style={{backgroundColor: 'var(--primary-color)'}} onClick={onSelectTopic}>
                        Ch·ªçn ch·ªß ƒë·ªÅ kh√°c
                     </button>
                </div>
            );
        }

        function CongratsScreen({ score, total, correctCount, playerName, topic, onPlayAgain, onSelectTopic, onReviewErrors, errors }) {
            return (
                <div className="topic-congrats-screen">
                    <div className="message" style={{ color: 'var(--success-color)', fontSize: '1.5em', lineHeight: '1.4' }}>
                        Ch√∫c m·ª´ng <strong>{playerName}</strong>!<br />
                        B·∫°n ƒë√£ ƒë·∫°t {score} ƒëi·ªÉm, ho√†n th√†nh ƒë√∫ng {correctCount}/{total} c√¢u trong "{topic}".
                    </div>
                    {errors.length > 0 && (
                         <button className="congrats-btn" style={{backgroundColor: 'var(--yellow-color)', color: 'var(--text-color)'}} onClick={onReviewErrors}>
                            Xem l·∫°i l·ªói sai ({errors.length})
                         </button>
                    )}
                    <button className="congrats-btn" style={{backgroundColor: 'var(--success-color)'}} onClick={onPlayAgain}>Ch∆°i l·∫°i ch·ªß ƒë·ªÅ n√†y</button>
                    <button className="congrats-btn" style={{backgroundColor: 'var(--primary-dark)'}} onClick={onSelectTopic}>Ch·ªçn ch·ªß ƒë·ªÅ kh√°c</button>
                    <Fireworks />
                </div>
            );
        }

        function GameScreen({ sentences, onGameEnd, onBackToTopics, topicName }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [completed, setCompleted] = useState(0);
            const [correctCount, setCorrectCount] = useState(0);
            const [mistakeCount, setMistakeCount] = useState(0);
            const [userAnswer, setUserAnswer] = useState('');
            const [message, setMessage] = useState('');
            const [messageColor, setMessageColor] = useState('var(--error-color)');
            const [isCorrect, setIsCorrect] = useState(null);
            const [isLocked, setIsLocked] = useState(false);
            const [errors, setErrors] = useState([]);
            
            const { isSpeaking, speak, cancel } = useSpeechSynthesis();
            const inputRef = useRef(null);
            const nextSentenceTimeoutRef = useRef(null);

            const currentSentence = sentences[currentIndex];
            
            const normalizeAnswer = (str) => {
                if (typeof str !== 'string') return '';
                // Normalize quotes and remove extra spaces
                return str.trim()
                    .replace(/[\u2018\u2019\u201A\u201B\u2032\u2035`]/g, "'")
                    .replace(/[\u201C\u201D\u201E\u201F\u2033\u2036]/g, '"')
                    .replace(/\s+/g, ' ');
            };

            const startNewSentence = useCallback((index) => {
                cancel();
                if (nextSentenceTimeoutRef.current) clearTimeout(nextSentenceTimeoutRef.current);

                if (index >= sentences.length) {
                    onGameEnd({ score, completed, correctCount, errors });
                    return;
                }
                
                setCurrentIndex(index);
                setUserAnswer('');
                setMistakeCount(0);
                setMessage('');
                setIsCorrect(null);
                setIsLocked(false);
                inputRef.current?.focus();
                
                const sentenceToSpeak = sentences[index].en;
                speak(sentenceToSpeak);

            }, [sentences, onGameEnd, score, completed, correctCount, errors, cancel, speak]);
            
            useEffect(() => {
                startNewSentence(0);
                return () => {
                    cancel();
                    if (nextSentenceTimeoutRef.current) clearTimeout(nextSentenceTimeoutRef.current);
                };
            }, [sentences]);

            const handleCheckAnswer = () => {
                if (isLocked) return;
                
                const correctAnswer = currentSentence.en;

                if (normalizeAnswer(userAnswer) === normalizeAnswer(correctAnswer)) {
                    setIsCorrect(true);
                    setIsLocked(true);
                    setMessage('Ch√≠nh x√°c! +10 ƒëi·ªÉm.');
                    setMessageColor('var(--success-color)');
                    setScore(prev => prev + 10);
                    setCorrectCount(prev => prev + 1);
                    setCompleted(prev => prev + 1);
                    cancel();
                    speak(correctAnswer, { onEnd: () => {
                        nextSentenceTimeoutRef.current = setTimeout(() => startNewSentence(currentIndex + 1), 2000);
                    }});
                } else {
                    const newMistakeCount = mistakeCount + 1;
                    setMistakeCount(newMistakeCount);
                    setIsCorrect(false);
                    
                    if (newMistakeCount >= 3) {
                        setIsLocked(true);
                        setMessage(`B·∫°n ƒë√£ sai 3 l·∫ßn. ƒê√°p √°n: "${correctAnswer}"`);
                        setErrors(prev => [...prev, { correctAnswer, userAnswer: userAnswer.trim() }]);
                        setCompleted(prev => prev + 1);
                        cancel();
                        nextSentenceTimeoutRef.current = setTimeout(() => startNewSentence(currentIndex + 1), 3500);
                    } else {
                        setMessage(`Sai r·ªìi! (S·ªë l·∫ßn sai: ${newMistakeCount}/3)`);
                        setTimeout(() => setIsCorrect(null), 500);
                    }
                }
            };
            
            const handleListenAgain = () => {
                if (!isSpeaking) {
                    speak(currentSentence.en);
                }
            };

            const hintRef = useRef(null);

            const showHint = () => {
                if(hintRef.current) hintRef.current.style.display = 'block';
            };
            const hideHint = () => {
                if(hintRef.current) hintRef.current.style.display = 'none';
            };


            if (!currentSentence) return <div>ƒêang t·∫£i...</div>;

            return (
                <div className="game-screen">
                    <div className="game-subtitle">Ch·ªß ƒë·ªÅ: {topicName}</div>
                    <div className="meaning">
                        <span>&ldquo;{currentSentence.vi}&rdquo;</span>
                        <span>{currentSentence.emoji}</span>
                    </div>
                    <div className="input-container">
                        <input
                            ref={inputRef}
                            type="text"
                            id="answerInput"
                            placeholder="Nh·∫≠p c√¢u b·∫°n nghe ƒë∆∞·ª£c..."
                            autoComplete="off"
                            autoCorrect="off"
                            autoCapitalize="off"
                            spellCheck="false"
                            value={userAnswer}
                            onChange={(e) => setUserAnswer(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCheckAnswer()}
                            disabled={isLocked}
                            className={`${isCorrect === true ? 'correct' : ''} ${isCorrect === false ? 'incorrect' : ''}`}
                        />
                        <div id="hint" ref={hintRef}>{currentSentence.en}</div>
                    </div>
                    <div className="message" style={{ color: messageColor }}>{message}</div>
                    <div className="buttons">
                        <button id="listenAgainBtn" onClick={handleListenAgain} disabled={isSpeaking || isLocked}>Nghe l·∫°i</button>
                        <button id="checkBtn" onClick={handleCheckAnswer} disabled={isLocked}>Ki·ªÉm tra</button>
                         <button 
                            id="hintBtn" 
                            disabled={isLocked}
                            onMouseDown={showHint}
                            onMouseUp={hideHint}
                            onMouseLeave={hideHint}
                            onTouchStart={(e) => { e.preventDefault(); showHint(); }}
                            onTouchEnd={hideHint}
                            style={{backgroundColor: 'var(--yellow-color)', color: 'var(--text-color)'}}
                        >
                            G·ª£i √Ω
                        </button>
                        <button id="resetBtn" onClick={onBackToTopics} style={{backgroundColor: '#757575'}}>Ch·ªß ƒë·ªÅ kh√°c</button>
                    </div>
                    <div className="score">ƒêi·ªÉm: {score} | Ho√†n th√†nh: {completed}/{sentences.length}</div>
                </div>
            );
        }

        function App() {
            const [gameState, setGameState] = useState(GameState.START);
            const [playerName, setPlayerName] = useState('');
            const [currentTopic, setCurrentTopic] = useState(null);
            const [gameResult, setGameResult] = useState({ score: 0, total: 0, correctCount: 0, errors: [] });
            
            const { cancel: cancelSpeech } = useSpeechSynthesis();

            const handleStart = (name) => {
                setPlayerName(name);
                setGameState(GameState.TOPIC_SELECTION);
            };

            const handleSelectTopic = (topic) => {
                setCurrentTopic(topic);
                setGameState(GameState.GAME);
            };
            
            const handleBackToTopics = () => {
                cancelSpeech();
                setGameState(GameState.TOPIC_SELECTION);
            };

            const handleGameEnd = (result) => {
                setGameResult({
                     score: result.score, 
                     total: topics[currentTopic].length,
                     correctCount: result.correctCount,
                     errors: result.errors
                });
                setGameState(GameState.CONGRATS);
            };
            
            const handlePlayAgain = () => {
                setGameState(GameState.GAME);
            };
            
            const handleReviewErrors = () => {
                setGameState(GameState.REVIEW_ERRORS);
            };

            const renderScreen = () => {
                switch (gameState) {
                    case GameState.START:
                        return <StartScreen onStart={handleStart} />;
                    case GameState.TOPIC_SELECTION:
                        return <TopicSelectionScreen onSelectTopic={handleSelectTopic} />;
                    case GameState.GAME:
                        return <GameScreen 
                                    sentences={topics[currentTopic]}
                                    topicName={currentTopic} 
                                    onGameEnd={handleGameEnd} 
                                    onBackToTopics={handleBackToTopics} 
                                />;
                    case GameState.CONGRATS:
                        return <CongratsScreen 
                                    {...gameResult} 
                                    playerName={playerName} 
                                    topic={currentTopic}
                                    onPlayAgain={handlePlayAgain}
                                    onSelectTopic={handleBackToTopics}
                                    onReviewErrors={handleReviewErrors}
                                />;
                    case GameState.REVIEW_ERRORS:
                        return <ReviewErrorsScreen 
                                    errors={gameResult.errors} 
                                    onSelectTopic={handleBackToTopics}
                               />
                    default:
                        return <StartScreen onStart={handleStart} />;
                }
            };

            return (
                <div className="container">
                    <div className="game-title">NGHE V√Ä VI·∫æT CH√çNH T·∫¢</div>
                    {renderScreen()}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>
